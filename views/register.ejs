<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('./partials/head'); %>
    <title>Register Page</title>
  </head>
  <body>
    <%- include('./partials/header'); %>
    <div class="container">
      <div id="flashAlert"></div>
      <h1>Register Page</h1>
      <form>
        <div class="error" style="background-color: red;"></div>
        <br />
        <label for="username">Username</label><br />
        <input type="text" id="username" required /><br />
        <label for="password">Password</label><br />
        <input type="password" id="password" required /><br />
        <input type="submit" value="register" /><br />
      </form>
      <br>
      <br>
      <a href="/login">Already registered? Login</a>
    </div>
    <script>
      const form = document.querySelector('form')     
      form.addEventListener('submit', async (e) => {
        console.log("submitting form");
        console.log($("#username").val());
        console.log($("#password").val());
         e.preventDefault()
        //  display.textContent = ''
         $.ajax({
            type: "POST",
            url: '/user/create',
            data:{
              username: $("#username").val(),
              password: $("#password").val()
            },
            success: function(response){
                console.log(response);
                window.location.href ='/admin';
            },   error: function(error) {
                  console.log("ERROR");
                  console.log("RESPONSE  FROM SERVER:");
                  console.log(error.responseJSON.message);
                  var div = document.createElement("div");
                  div.id= "test1";
                  div.innerHTML = `<br>
                    <div class="alert ${error.responseJSON.flash_type}">
                    ${error.responseJSON.message}.
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="float:right;">
                    </button>
                    </div>`
                
                  $("#flashAlert").prepend(div);
                  console.log(div);
                 
            }
        });
      })
    </script>
  </body>
</html>