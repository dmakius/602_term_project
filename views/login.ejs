<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('./partials/head'); %>
  </head>
  <body>
    <%- include('./partials/header'); %>
    <div class="container">
      <div id="flashAlert"></div>
      <h1>Login Page</h1>
      <form>
        <div class="error" style="background-color: red;"></div>
        <br />
        <label for="username">Username</label><br />
        <input type="text" id="username" required /><br />
        <label for="password">Password</label><br />
        <input type="password" id="password" required /><br />
        <input type="submit" value="login" /><br />
      </form>
      <br>
      <br>
      <a href="/register">Don't have an accout? Register</a>
    </div>
    <script>
        const form = document.querySelector('form');
        form.addEventListener('submit', async (e) => {
          e.preventDefault()
          console.log("submitting form");
          console.log($("#username").val());
          console.log($("#password").val());

         $.ajax({
            type: "POST",
            url: '/user/login',
            data:{
              username: $("#username").val(),
              password: $("#password").val()
            },
            success: function(response){
                console.log("RESPONSE  FROM SERVER:");
                console.log(response);
                window.location.href ='/admin';
            },   error: function(error) {
                  console.log("ERROR  FROM SERVER:");
                  console.log(error);
                  console.log(error.responseJSON.message);
                  var div = document.createElement("div");
                  div.id= "test1"
                  div.innerHTML = `
                    <br>
                    <div class="alert ${error.responseJSON.flash_type}">
                    ${error.responseJSON.message}.
                    <button type="button" class="close btn-close" data-bs-dismiss="alert" aria-label="Close" style="float:right;">

                    </button>
                    </div>
                    `;
                  $("#flashAlert").prepend(div);
                  console.log(div);
            }
        });
          
          })
        </script>
  </body>
</html>